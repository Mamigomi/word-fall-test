<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>40~45번 단어 낙하 테스트</title>
  <style>
    :root{
      --bg:#0b1220;
      --panel:#111a2b;
      --panel2:#0f1930;
      --text:#ffffff;
      --muted:rgba(255,255,255,.75);
      --danger:#ff4d4d;
      --ok:#3ddc97;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      overflow:hidden;
    }
    #wrap{
      max-width:520px;
      margin:0 auto;
      height:100vh;
      display:flex;
      flex-direction:column;
    }
    header{
      padding:14px 14px 10px;
      background:var(--panel);
      border-bottom:1px solid rgba(255,255,255,.08);
    }
    #english{
      font-size:24px;
      font-weight:900;
      letter-spacing:.2px;
      line-height:1.15;
      word-break:keep-all;
    }
    #progress{
      margin-top:6px;
      font-size:13px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      gap:10px;
    }
    #progress span{
      white-space:nowrap;
    }

    #game{
      position:relative;
      flex:1;
      background:linear-gradient(180deg, var(--panel2), rgba(15,25,48,.35));
      overflow:hidden;
    }
    #laneHint{
      position:absolute;
      inset:auto 0 10px 0;
      text-align:center;
      font-size:12px;
      color:rgba(255,255,255,.35);
      pointer-events:none;
    }

    .choice{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      width:calc(100% - 22px);
      max-width:480px;
      padding:14px 14px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.16);
      color:var(--text);
      border-radius:14px;
      font-size:18px;
      font-weight:800;
      text-align:center;
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
      user-select:none;
      touch-action:manipulation;
      cursor:pointer;
      box-shadow:0 10px 18px rgba(0,0,0,.25);
    }
    .choice:active{
      transform:translateX(-50%) scale(.98);
    }

    .line{
      position:absolute;
      left:0; right:0; bottom:0;
      height:8px;
      background:rgba(255,255,255,.06);
      border-top:1px solid rgba(255,255,255,.10);
    }

    /* Overlay */
    #overlay{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:18px;
      background:rgba(0,0,0,.55);
      opacity:0;
      pointer-events:none;
      transition:opacity .18s ease;
    }
    #overlay.show{
      opacity:1;
      pointer-events:auto;
    }
    .card{
      width:min(480px, 100%);
      background:rgba(17,26,43,.92);
      border:1px solid rgba(255,255,255,.14);
      border-radius:18px;
      padding:18px 16px;
      box-shadow:0 18px 40px rgba(0,0,0,.45);
      text-align:center;
    }
    .title{
      font-size:22px;
      font-weight:900;
      margin:2px 0 10px;
    }
    .msg{
      font-size:14px;
      color:var(--muted);
      line-height:1.45;
      margin:0 0 16px;
      white-space:pre-line;
    }
    .btnRow{
      display:flex;
      gap:10px;
      justify-content:center;
    }
    button{
      appearance:none;
      border:0;
      border-radius:14px;
      padding:12px 14px;
      font-weight:900;
      font-size:15px;
      cursor:pointer;
      min-width:140px;
    }
    #restartBtn{ background:var(--ok); color:#072014; }
    #startBtn{ background:#6aa8ff; color:#07162c; }
    .dangerText{ color:var(--danger); font-weight:900; }

    /* Small screens */
    @media (max-width:360px){
      #english{ font-size:22px; }
      .choice{ font-size:17px; padding:13px 12px; }
      button{ min-width:120px; }
    }
  </style>
</head>
<body>
  <div id="wrap">
    <header>
      <div id="english">Loading...</div>
      <div id="progress">
        <span id="countText">0 / 0</span>
        <span id="speedText">Speed × 1.0</span>
      </div>
    </header>

    <main id="game" aria-label="Word fall game">
      <div class="line"></div>
      <div id="laneHint">정답을 누르세요. 오답 또는 바닥 도달 시 즉시 종료</div>

      <div id="overlay">
        <div class="card">
          <div class="title" id="overlayTitle">준비</div>
          <p class="msg" id="overlayMsg">시작 버튼을 누르면 바로 진행됩니다.</p>
          <div class="btnRow">
            <button id="startBtn">시작</button>
            <button id="restartBtn" style="display:none;">다시 시작</button>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // =========================
    // ✅ 단어 목록 (40~45 범위)
    // =========================
    const words = [
      { en: "participating", ko: "참여하는" },
      { en: "chosen", ko: "선택된" },
      { en: "looking forward", ko: "기대하다" },
      { en: "introducing", ko: "소개하는" },
      { en: "unique", ko: "독특한" },
      { en: "handmade", ko: "수제의" },
      { en: "baskets", ko: "바구니" },
      { en: "organizing", ko: "조직하는" },
      { en: "exhibition plan", ko: "전시 계획" },
      { en: "happy", ko: "기쁜" },
      { en: "inform", ko: "알리다" },
      { en: "assigned", ko: "배정된" },
      { en: "table", ko: "테이블" },
      { en: "visitors", ko: "방문객들" },
      { en: "easily", ko: "쉽게" },
      { en: "located", ko: "위치한" },
      { en: "entrance", ko: "입구" },
      { en: "special", ko: "특별한" },
      { en: "requirements", ko: "요구 사항" },
      { en: "further", ko: "추가적인" },
      { en: "assistance", ko: "도움" },
      { en: "feel free", ko: "자유롭게 하다" },
      { en: "contact", ko: "연락하다" },
      { en: "in advance", ko: "미리" },
      { en: "Sincerely", ko: "진심으로" },

      { en: "shed", ko: "창고" },
      { en: "cold", ko: "차가운" },
      { en: "damp", ko: "축축한" },
      { en: "thick", ko: "짙은" },
      { en: "smell", ko: "냄새" },
      { en: "wood", ko: "나무" },
      { en: "earth", ko: "흙" },
      { en: "dark", ko: "어두운" },
      { en: "make out", ko: "식별하다" },
      { en: "moving", ko: "움직이는" },
      { en: "shadows", ko: "그림자" },
      { en: "ask", ko: "묻다" },
      { en: "voice", ko: "목소리" },
      { en: "shaking", ko: "떨리는" },
      { en: "heart", ko: "심장" },
      { en: "fast", ko: "빠른" },
      { en: "figure", ko: "형체" },
      { en: "beam", ko: "광선" },
      { en: "crack", ko: "균열" },
      { en: "rabbit", ko: "토끼" },
      { en: "laugh", ko: "웃다" },
      { en: "escape", ko: "빠져나가다" },
      { en: "stare", ko: "응시하다" },
      { en: "curious", ko: "호기심 많은" },
      { en: "scared", ko: "겁먹은" },
      { en: "pause", ko: "멈추다" },
      { en: "hop", ko: "뛰다" },
      { en: "disappear", ko: "사라지다" },
      { en: "smile", ko: "미소" },
      { en: "at ease", ko: "편안한" },
      { en: "feel", ko: "느끼다" },

      { en: "improving", ko: "향상시키는" },
      { en: "gestural", ko: "몸짓의" },
      { en: "communication", ko: "의사소통" },
      { en: "nod", ko: "고개를 끄덕이다" },
      { en: "shake hands", ko: "손을 흔들다" },
      { en: "complement", ko: "보완하다" },
      { en: "spoken", ko: "말로 하는" },
      { en: "layers", ko: "층" },
      { en: "honesty", ko: "정직" },
      { en: "atmosphere", ko: "분위기" },
      { en: "trust", ko: "신뢰" },
      { en: "openness", ko: "개방성" },
      { en: "collaboration", ko: "협력" },
      { en: "palms", ko: "손바닥" },
      { en: "facing up", ko: "위를 향한" },
      { en: "simple", ko: "간단한" },
      { en: "powerful", ko: "강력한" },
      { en: "comfortable", ko: "편안한" },
      { en: "overgesturing", ko: "과도하게 몸짓을 사용함" },
      { en: "distract", ko: "방해하다" },
      { en: "chaos", ko: "혼란" },
      { en: "balance", ko: "균형" },
      { en: "highlight", ko: "강조하다" },
      { en: "overshadow", ko: "가리다" },

      { en: "gene editing", ko: "유전자 편집" },
      { en: "humans", ko: "인간들" },
      { en: "safe", ko: "안전한" },
      { en: "effective", ko: "효과적인" },
      { en: "logical", ko: "논리적인" },
      { en: "preferable", ko: "바람직한" },
      { en: "disease-causing", ko: "질병을 일으키는" },
      { en: "mutations", ko: "돌연변이" },
      { en: "earliest", ko: "가장 이른" },
      { en: "harmful", ko: "해로운" },
      { en: "serious", ko: "심각한" },
      { en: "transform", ko: "변형하다" },
      { en: "embryo", ko: "배아" },
      { en: "mutated", ko: "돌연변이가 된" },
      { en: "normal", ko: "정상적인" },
      { en: "superior", ko: "우수한" },
      { en: "temptations", ko: "유혹" },
      { en: "upgrade", ko: "향상시키다" },
      { en: "lifetime", ko: "평생" },
      { en: "risk", ko: "위험" },
      { en: "heart disease", ko: "심장병" },
      { en: "cancer", ko: "암" },
      { en: "beneficial", ko: "유익한" },
      { en: "features", ko: "특징" },
      { en: "strength", ko: "힘" },
      { en: "mental abilities", ko: "정신 능력" },
      { en: "physical", ko: "신체적인" },
      { en: "characteristics", ko: "특성" },
      { en: "eye color", ko: "눈 색깔" },
      { en: "hair color", ko: "머리 색깔" },
      { en: "pursuit", ko: "추구" },
      { en: "perfection", ko: "완벽함" },
      { en: "slippery slope", ko: "미끄러운 경사로" },
      { en: "may not like", ko: "좋아하지 않을지도 모른다" },
      { en: "end up", ko: "끝나다" },

      { en: "grade school", ko: "초등학교" },
      { en: "collection", ko: "모음" },
      { en: "certainties", ko: "확실성" },
      { en: "natural world", ko: "자연 세계" },
      { en: "earth", ko: "지구" },
      { en: "sun", ko: "태양" },
      { en: "DNA", ko: "DNA" },
      { en: "carries", ko: "전달하다" },
      { en: "information", ko: "정보" },
      { en: "organism", ko: "유기체" },
      { en: "practice", ko: "실천" },
      { en: "realize", ko: "깨닫다" },
      { en: "facts", ko: "사실" },
      { en: "hard won", ko: "어렵게 얻어진" },
      { en: "succession", ko: "연속" },
      { en: "logical", ko: "논리적인" },
      { en: "inferences", ko: "추론" },
      { en: "observations", ko: "관찰" },
      { en: "experiments", ko: "실험" },
      { en: "process", ko: "과정" },
      { en: "reducing", ko: "줄이다" },
      { en: "uncertainties", ko: "불확실성" },
      { en: "greater", ko: "더 큰" },
      { en: "lesser", ko: "더 작은" },
      { en: "knowledge", ko: "지식" },
      { en: "given", ko: "주어진" },
      { en: "piece", ko: "조각" },
      { en: "quite", ko: "꽤" },
      { en: "certain", ko: "확신하는" },
      { en: "fall", ko: "떨어지다" },
      { en: "tree", ko: "나무" },
      { en: "understanding", ko: "이해" },
      { en: "turbulent", ko: "난기류의" },
      { en: "fluid flow", ko: "유체 흐름" },
      { en: "work in progress", ko: "진행 중인 작업" },
      { en: "century", ko: "세기" },
      { en: "effort", ko: "노력" }
    ];

    // ============
    // Game Settings
    // ============
    const GAME = {
      choicesCount: 4,
      baseSpeed: 130,       // px/sec
      speedStep: 22,        // +px/sec per 5 questions
      speedEvery: 5,        // increase every N correct
      spawnGap: 380,        // vertical gap between falling choices
      choiceHeight: 58,     // approx height used for fail line check
      startDelayMs: 120     // small delay after start/next
    };

    // ============
    // DOM
    // ============
    const gameEl = document.getElementById("game");
    const englishEl = document.getElementById("english");
    const countText = document.getElementById("countText");
    const speedText = document.getElementById("speedText");
    const overlay = document.getElementById("overlay");
    const overlayTitle = document.getElementById("overlayTitle");
    const overlayMsg = document.getElementById("overlayMsg");
    const startBtn = document.getElementById("startBtn");
    const restartBtn = document.getElementById("restartBtn");

    // ============
    // State
    // ============
    let pool = [];
    let current = null;
    let correctCount = 0;
    let speed = GAME.baseSpeed;

    let running = false;
    let rafId = null;
    let lastTs = 0;

    // active choice elements with y
    let active = [];

    // ============
    // Helpers
    // ============
    function shuffle(arr){
      const a = arr.slice();
      for(let i=a.length-1;i>0;i--){
        const j = (Math.random()*(i+1))|0;
        [a[i],a[j]] = [a[j],a[i]];
      }
      return a;
    }

    function pickRandom(arr){
      return arr[(Math.random()*arr.length)|0];
    }

    function uniqueWrongKOs(correctKo, count){
      const set = new Set([correctKo]);
      const out = [];
      // prevent duplicates even if same ko appears (earth/지구 vs 흙 already distinct, but still safe)
      while(out.length < count){
        const w = pickRandom(words);
        if(!set.has(w.ko)){
          set.add(w.ko);
          out.push(w.ko);
        }
      }
      return out;
    }

    function clearChoices(){
      for(const item of active){
        item.el.remove();
      }
      active = [];
    }

    function updateHUD(){
      countText.textContent = `${correctCount} / ${words.length}`;
      const mult = (speed / GAME.baseSpeed).toFixed(1);
      speedText.textContent = `Speed × ${mult}`;
    }

    function showOverlay(title, msg, { showStart=false, showRestart=false } = {}){
      overlayTitle.textContent = title;
      overlayMsg.textContent = msg;
      startBtn.style.display = showStart ? "" : "none";
      restartBtn.style.display = showRestart ? "" : "none";
      overlay.classList.add("show");
    }

    function hideOverlay(){
      overlay.classList.remove("show");
    }

    // ============
    // Game Flow
    // ============
    function resetGame(){
      cancelAnimationFrame(rafId);
      rafId = null;
      running = false;
      lastTs = 0;

      pool = shuffle(words);
      current = null;
      correctCount = 0;
      speed = GAME.baseSpeed;

      clearChoices();
      englishEl.textContent = "준비";
      updateHUD();

      showOverlay(
        "단어 낙하 테스트",
        "규칙:\n1) 정답을 누르세요.\n2) 오답을 누르거나 선택지가 바닥에 닿으면 즉시 종료됩니다.\n3) 5문항마다 속도가 빨라집니다.",
        { showStart:true, showRestart:false }
      );
    }

    function fail(reason){
      running = false;
      cancelAnimationFrame(rafId);
      rafId = null;

      showOverlay(
        "불합격",
        `${reason}\n\n진행도: ${correctCount} / ${words.length}`,
        { showStart:false, showRestart:true }
      );
    }

    function pass(){
      running = false;
      cancelAnimationFrame(rafId);
      rafId = null;

      showOverlay(
        "합격",
        "40~45번 단어테스트 통과!",
        { showStart:false, showRestart:true }
      );
    }

    function nextQuestion(){
      clearChoices();

      if(pool.length === 0){
        pass();
        return;
      }

      current = pool.shift();
      englishEl.textContent = current.en;

      // build choices
      const wrongs = uniqueWrongKOs(current.ko, GAME.choicesCount - 1);
      const options = shuffle([current.ko, ...wrongs]);

      // spawn choices above the screen with gaps
      const startY = -70;
      active = options.map((ko, idx) => {
        const btn = document.createElement("div");
        btn.className = "choice";
        btn.textContent = ko;
        btn.setAttribute("role", "button");
        btn.setAttribute("tabindex", "0");

        btn.addEventListener("click", () => onPick(ko));
        btn.addEventListener("keydown", (e) => {
          if(e.key === "Enter" || e.key === " "){
            e.preventDefault();
            onPick(ko);
          }
        });

        gameEl.appendChild(btn);

        const y = startY - idx * GAME.spawnGap;
        btn.style.top = `${y}px`;

        return { el: btn, ko, y };
      });

      updateHUD();
    }

    function onPick(ko){
      if(!running) return;

      if(ko === current.ko){
        correctCount += 1;

        // speed up every N
        if(correctCount % GAME.speedEvery === 0){
          speed += GAME.speedStep;
        }

        // small breathing space
        running = false;
        setTimeout(() => {
          running = true;
          nextQuestion();
        }, GAME.startDelayMs);

      }else{
        fail("오답을 선택했습니다.");
      }
    }

    function tick(ts){
      if(!lastTs) lastTs = ts;
      const dt = Math.min(0.033, (ts - lastTs) / 1000); // clamp
      lastTs = ts;

      if(running){
        const h = gameEl.clientHeight;
        for(const item of active){
          item.y += speed * dt;
          item.el.style.top = `${item.y}px`;

          // if any reaches bottom line => fail
          if(item.y + GAME.choiceHeight >= h - 8){
            fail("선택지가 바닥에 닿았습니다.");
            return;
          }
        }
      }

      rafId = requestAnimationFrame(tick);
    }

    function startGame(){
      hideOverlay();
      clearChoices();

      // 첫 문제 준비
      running = false;
      setTimeout(() => {
        running = true;
        nextQuestion();
      }, GAME.startDelayMs);

      cancelAnimationFrame(rafId);
      rafId = requestAnimationFrame(tick);
    }

    // ============
    // Buttons
    // ============
    startBtn.addEventListener("click", startGame);
    restartBtn.addEventListener("click", () => {
      resetGame();
      // 바로 시작까지 원하면 아래 두 줄을 활성화하세요.
      // hideOverlay();
      // startGame();
    });

    // init
    resetGame();
  </script>
</body>
</html>
